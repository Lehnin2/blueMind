{% extends "base.html" %}

{% block title %}Apprentissage{% endblock %}

{% block head %}
<style>
    .learning-container {
        background: linear-gradient(135deg, rgba(50, 30, 0, 0.8), rgba(60, 30, 10, 0.8));
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        border: 1px solid rgba(205, 133, 63, 0.3);
        margin-bottom: 20px;
    }
    
    .quiz-card {
        background: linear-gradient(135deg, rgba(50, 30, 0, 0.8), rgba(60, 30, 10, 0.8));
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        border: 1px solid rgba(205, 133, 63, 0.3);
        transition: transform 0.3s ease;
    }
    
    .quiz-card:hover {
        transform: translateY(-5px);
    }
    
    .quiz-option {
        background-color: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(205, 133, 63, 0.3);
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 10px;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .quiz-option:hover {
        background-color: rgba(205, 133, 63, 0.2);
    }
    
    .quiz-option.selected {
        background-color: rgba(205, 133, 63, 0.4);
        border-color: rgba(205, 133, 63, 0.8);
    }
    
    .quiz-option.correct {
        background-color: rgba(25, 135, 84, 0.4);
        border-color: rgba(25, 135, 84, 0.8);
    }
    
    .quiz-option.incorrect {
        background-color: rgba(220, 53, 69, 0.4);
        border-color: rgba(220, 53, 69, 0.8);
    }
    
    .progress-container {
        margin: 30px 0;
    }
    
    .progress {
        height: 10px;
        background-color: rgba(255, 255, 255, 0.1);
        border-radius: 5px;
        overflow: hidden;
    }
    
    .progress-bar {
        background: linear-gradient(90deg, #CD853F, #8B4513);
        transition: width 0.5s ease;
    }
    
    .badge-level {
        background: linear-gradient(135deg, #CD853F, #8B4513);
        color: white;
        font-size: 0.9rem;
        padding: 8px 15px;
        border-radius: 20px;
        margin-bottom: 15px;
        display: inline-block;
    }
    
    .achievement-card {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 15px;
        border: 1px solid rgba(205, 133, 63, 0.3);
        display: flex;
        align-items: center;
    }
    
    .achievement-icon {
        width: 50px;
        height: 50px;
        background-color: rgba(205, 133, 63, 0.2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 15px;
        font-size: 1.5rem;
        color: #CD853F;
    }
    
    .achievement-locked {
        opacity: 0.5;
    }
    
    .chatbot-widget {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 350px;
        background: linear-gradient(135deg, rgba(50, 30, 0, 0.9), rgba(60, 30, 10, 0.9));
        border-radius: 15px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(205, 133, 63, 0.3);
        z-index: 1000;
        overflow: hidden;
        transition: all 0.3s ease;
    }
    
    .chatbot-header {
        background: linear-gradient(90deg, #CD853F, #8B4513);
        color: white;
        padding: 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .chatbot-body {
        height: 300px;
        overflow-y: auto;
        padding: 15px;
    }
    
    .chatbot-footer {
        padding: 10px;
        border-top: 1px solid rgba(205, 133, 63, 0.3);
        display: flex;
    }
    
    .chatbot-input {
        flex: 1;
        background-color: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(205, 133, 63, 0.3);
        color: white;
        border-radius: 20px;
        padding: 8px 15px;
    }
    
    .chatbot-send {
        background-color: rgba(205, 133, 63, 0.8);
        border: none;
        color: white;
        border-radius: 50%;
        width: 36px;
        height: 36px;
        margin-left: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .message {
        margin-bottom: 15px;
        display: flex;
        flex-direction: column;
    }
    
    .message-bot {
        align-items: flex-start;
    }
    
    .message-user {
        align-items: flex-end;
    }
    
    .message-content {
        padding: 10px 15px;
        border-radius: 15px;
        max-width: 80%;
    }
    
    .message-bot .message-content {
        background-color: rgba(255, 255, 255, 0.1);
        color: white;
        border-top-left-radius: 0;
    }
    
    .message-user .message-content {
        background-color: rgba(205, 133, 63, 0.4);
        color: white;
        border-top-right-radius: 0;
    }
    
    .message-time {
        font-size: 0.7rem;
        margin-top: 5px;
        color: rgba(255, 255, 255, 0.5);
    }
    
    .chatbot-toggle {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 60px;
        height: 60px;
        background: linear-gradient(135deg, #CD853F, #8B4513);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.5rem;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        cursor: pointer;
        z-index: 1001;
    }
    
    .chatbot-widget.collapsed {
        height: 0;
        padding: 0;
        border: none;
    }
    
    .nav-tabs .nav-link {
        color: rgba(255, 255, 255, 0.7);
        border: none;
        padding: 10px 20px;
        border-radius: 30px;
        margin-right: 5px;
        transition: all 0.3s ease;
    }
    
    .nav-tabs .nav-link:hover {
        color: white;
        background-color: rgba(205, 133, 63, 0.3);
    }
    
    .nav-tabs .nav-link.active {
        color: white;
        background-color: rgba(205, 133, 63, 0.7);
        border: none;
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="display-5 fw-bold text-white mb-3">Apprentissage Interactif</h1>
            <p class="text-white-50 mb-4">Testez vos connaissances sur la réglementation de la pêche à travers des quiz interactifs et progressez dans votre apprentissage.</p>
        </div>
    </div>
    
    <div class="row">
        <div class="col-lg-8">
            <ul class="nav nav-tabs mb-4" id="learningTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="quiz-tab" data-bs-toggle="tab" data-bs-target="#quiz" type="button" role="tab" aria-controls="quiz" aria-selected="true">
                        <i class="bi bi-question-circle me-2"></i>Quiz
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="progress-tab" data-bs-toggle="tab" data-bs-target="#progress" type="button" role="tab" aria-controls="progress" aria-selected="false">
                        <i class="bi bi-graph-up me-2"></i>Progression
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="achievements-tab" data-bs-toggle="tab" data-bs-target="#achievements" type="button" role="tab" aria-controls="achievements" aria-selected="false">
                        <i class="bi bi-trophy me-2"></i>Récompenses
                    </button>
                </li>
            </ul>
            
            <div class="tab-content" id="learningTabsContent">
                <!-- Onglet Quiz -->
                <div class="tab-pane fade show active" id="quiz" role="tabpanel" aria-labelledby="quiz-tab">
                    <div class="learning-container">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h4 class="text-white mb-0">Quiz: Réglementation Générale</h4>
                            <span class="badge-level">Niveau 2</span>
                        </div>
                        
                        <div class="progress-container">
                            <div class="d-flex justify-content-between mb-2">
                                <span class="text-white-50">Question 3/10</span>
                                <span class="text-white-50">Score: 2/2</span>
                            </div>
                            <div class="progress">
                                <div class="progress-bar" role="progressbar" style="width: 30%" aria-valuenow="30" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>
                        
                        <div id="current-question" class="mb-4">
                            <h5 class="text-white mb-3">Quel engin est interdit pour la pêche en eau douce ?</h5>
                            
                            <div class="quiz-option" data-option="1">
                                <div class="d-flex align-items-center">
                                    <div class="me-3">A.</div>
                                    <div>La canne à pêche avec moulinet</div>
                                </div>
                            </div>
                            
                            <div class="quiz-option" data-option="2">
                                <div class="d-flex align-items-center">
                                    <div class="me-3">B.</div>
                                    <div>L'épuisette</div>
                                </div>
                            </div>
                            
                            <div class="quiz-option" data-option="3">
                                <div class="d-flex align-items-center">
                                    <div class="me-3">C.</div>
                                    <div>Le filet traînant</div>
                                </div>
                            </div>
                            
                            <div class="quiz-option" data-option="4">
                                <div class="d-flex align-items-center">
                                    <div class="me-3">D.</div>
                                    <div>La balance à écrevisses</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="d-flex justify-content-between">
                            <button class="btn btn-outline-light" id="prev-question"><i class="bi bi-arrow-left me-2"></i>Précédent</button>
                            <button class="btn btn-primary" id="next-question">Suivant<i class="bi bi-arrow-right ms-2"></i></button>
                        </div>
                    </div>
                </div>
                
                <!-- Onglet Progression -->
                <div class="tab-pane fade" id="progress" role="tabpanel" aria-labelledby="progress-tab">
                    <div class="learning-container">
                        <h4 class="text-white mb-4">Votre progression</h4>
                        
                        <div class="row mb-4">
                            <div class="col-md-4 text-center mb-3 mb-md-0">
                                <div class="stats-number">65%</div>
                                <div class="text-white-50">Progression globale</div>
                            </div>
                            <div class="col-md-4 text-center mb-3 mb-md-0">
                                <div class="stats-number">12</div>
                                <div class="text-white-50">Quiz complétés</div>
                            </div>
                            <div class="col-md-4 text-center">
                                <div class="stats-number">8</div>
                                <div class="text-white-50">Récompenses</div>
                            </div>
                        </div>
                        
                        <h5 class="text-white mb-3">Modules complétés</h5>
                        <div class="mb-4">
                            <div class="d-flex justify-content-between mb-2">
                                <span class="text-white">Réglementation générale</span>
                                <span class="text-white">80%</span>
                            </div>
                            <div class="progress">
                                <div class="progress-bar" role="progressbar" style="width: 80%" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <div class="d-flex justify-content-between mb-2">
                                <span class="text-white">Espèces protégées</span>
                                <span class="text-white">60%</span>
                            </div>
                            <div class="progress">
                                <div class="progress-bar" role="progressbar" style="width: 60%" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <div class="d-flex justify-content-between mb-2">
                                <span class="text-white">Zones de pêche</span>
                                <span class="text-white">45%</span>
                            </div>
                            <div class="progress">
                                <div class="progress-bar" role="progressbar" style="width: 45%" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Onglet Récompenses -->
                <div class="tab-pane fade" id="achievements" role="tabpanel" aria-labelledby="achievements-tab">
                    <div class="learning-container">
                        <h4 class="text-white mb-4">Vos récompenses</h4>
                        
                        <div class="achievement-card">
                            <div class="achievement-icon">
                                <i class="bi bi-star-fill"></i>
                            </div>
                            <div>
                                <h5 class="text-white mb-1">Premier pas</h5>
                                <p class="text-white-50 mb-0">Complétez votre premier quiz</p>
                            </div>
                        </div>
                        
                        <div class="achievement-card">
                            <div class="achievement-icon">
                                <i class="bi bi-award-fill"></i>
                            </div>
                            <div>
                                <h5 class="text-white mb-1">Expert en herbe</h5>
                                <p class="text-white-50 mb-0">Obtenez un score parfait sur 3 quiz consécutifs</p>
                            </div>
                        </div>
                        
                        <div class="achievement-card achievement-locked">
                            <div class="achievement-icon">
                                <i class="bi bi-lock-fill"></i>
                            </div>
                            <div>
                                <h5 class="text-white mb-1">Maître de la réglementation</h5>
                                <p class="text-white-50 mb-0">Complétez tous les quiz du module Réglementation</p>
                            </div>
                        </div>
                        
                        <div class="achievement-card achievement-locked">
                            <div class="achievement-icon">
                                <i class="bi bi-lock-fill"></i>
                            </div>
                            <div>
                                <h5 class="text-white mb-1">Protecteur des espèces</h5>
                                <p class="text-white-50 mb-0">Identifiez correctement toutes les espèces protégées</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4 mt-4 mt-lg-0">
            <div class="learning-container">
                <h4 class="text-white mb-4">Modules disponibles</h4>
                
                <div class="quiz-card">
                    <h5 class="text-white mb-2">Réglementation générale</h5>
                    <p class="text-white-50 mb-3">Apprenez les bases de la réglementation de la pêche en France.</p>
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="badge-level">Niveau 1-3</span>
                        <button class="btn btn-sm btn-primary">Commencer</button>
                    </div>
                </div>
                
                <div class="quiz-card">
                    <h5 class="text-white mb-2">Espèces protégées</h5>
                    <p class="text-white-50 mb-3">Identifiez les espèces protégées et les périodes de protection.</p>
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="badge-level">Niveau 2-4</span>
                        <button class="btn btn-sm btn-primary">Commencer</button>
                    </div>
                </div>
                
                <div class="quiz-card">
                    <h5 class="text-white mb-2">Zones de pêche</h5>
                    <p class="text-white-50 mb-3">Découvrez les différentes zones de pêche et leurs spécificités.</p>
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="badge-level">Niveau 3-5</span>
                        <button class="btn btn-sm btn-primary">Commencer</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Chatbot Widget -->
<div class="chatbot-toggle" id="chatbot-toggle">
    <i class="bi bi-chat-dots-fill"></i>
</div>

<div class="chatbot-widget collapsed" id="chatbot-widget">
    <div class="chatbot-header">
        <div>
            <i class="bi bi-robot me-2"></i>
            <span>Assistant d'apprentissage</span>
        </div>
        <button class="btn btn-sm text-white" id="chatbot-close">
            <i class="bi bi-x-lg"></i>
        </button>
    </div>
    
    <div class="chatbot-body" id="chatbot-messages">
        <div class="message message-bot">
            <div class="message-content">
                Bonjour ! Je suis votre assistant d'apprentissage. Comment puis-je vous aider aujourd'hui ?
            </div>
            <div class="message-time">14:30</div>
        </div>
        
        <div class="message message-user">
            <div class="message-content">
                J'ai une question sur les tailles minimales de capture.
            </div>
            <div class="message-time">14:31</div>
        </div>
        
        <div class="message message-bot">
            <div class="message-content">
                Bien sûr ! Les tailles minimales de capture varient selon les espèces. Pour quelle espèce souhaitez-vous connaître la taille minimale ?
            </div>
            <div class="message-time">14:31</div>
        </div>
    </div>
    
    <div class="chatbot-footer">
        <input type="text" class="chatbot-input" id="chatbot-input" placeholder="Posez votre question...">
        <button class="chatbot-send" id="chatbot-send">
            <i class="bi bi-send-fill"></i>
        </button>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Gestion des options du quiz
        const quizOptions = document.querySelectorAll('.quiz-option');
        quizOptions.forEach(option => {
            option.addEventListener('click', function() {
                // Réinitialiser toutes les options
                quizOptions.forEach(opt => {
                    opt.classList.remove('selected', 'correct', 'incorrect');
                });
                
                // Sélectionner l'option cliquée
                this.classList.add('selected');
                
                // Simuler la vérification de la réponse (pour démonstration)
                setTimeout(() => {
                    if (this.dataset.option === '3') { // Supposons que l'option 3 est correcte
                        this.classList.add('correct');
                    } else {
                        this.classList.add('incorrect');
                        // Montrer la bonne réponse
                        quizOptions[2].classList.add('correct'); // L'index 2 correspond à l'option 3
                    }
                }, 500);
            });
        });
        
        // Gestion du chatbot
        const chatbotToggle = document.getElementById('chatbot-toggle');
        const chatbotWidget = document.getElementById('chatbot-widget');
        const chatbotClose = document.getElementById('chatbot-close');
        const chatbotInput = document.getElementById('chatbot-input');
        const chatbotSend = document.getElementById('chatbot-send');
        const chatbotMessages = document.getElementById('chatbot-messages');
        
        chatbotToggle.addEventListener('click', function() {
            chatbotWidget.classList.toggle('collapsed');
        });
        
        chatbotClose.addEventListener('click', function() {
            chatbotWidget.classList.add('collapsed');
        });
        
        function sendMessage() {
            const message = chatbotInput.value.trim();
            if (message) {
                // Ajouter le message de l'utilisateur
                addMessage(message, 'user');
                chatbotInput.value = '';
                
                // Simuler une réponse du chatbot (à remplacer par un appel API)
                setTimeout(() => {
                    processChatMessage(message);
                }, 1000);
            }
        }
        
        chatbotSend.addEventListener('click', sendMessage);
        
        chatbotInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
        
        function addMessage(content, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message message-${sender}`;
            
            const now = new Date();
            const time = `${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')}`;
            
            messageDiv.innerHTML = `
                <div class="message-content">${content}</div>
                <div class="message-time">${time}</div>
            `;
            
            chatbotMessages.appendChild(messageDiv);
            chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
        }
        
        function processChatMessage(message) {
            // Ici, vous feriez normalement un appel à l'API de chat
            // Pour la démonstration, nous simulons une réponse simple
            
            // Envoyer le message au backend (à implémenter)
            fetch('/api/chat', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams({
                    'message': message,
                })
            })
            .then(response => response.json())
            .then(data => {
                // Ajouter la réponse du chatbot
                addMessage(data.response || "Je suis désolé, je n'ai pas compris votre question. Pourriez-vous reformuler ?", 'bot');
            })
            .catch(error => {
                console.error('Erreur:', error);
                // Réponse par défaut en cas d'erreur
                addMessage("Désolé, je rencontre des difficultés techniques. Veuillez réessayer plus tard.", 'bot');
            });
        }
    });
</script>
{% endblock %}